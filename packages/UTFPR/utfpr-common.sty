%% normas-utf-tex.cls
%% Copyright 200?-2011 Diogo Rosa Kuiaski <diogo.kuiaski@gmail.com>
%% Copyright 200?-2011 Hugo Vieira Neto <hvieir@utfpr.edu.br>
%% Copyright 2011      César M. Vargas Benítez <cesarvargasb@gmail.com>
%% Copyright 2011-2013      Marcos Talau <talau@users.sourceforge.net>
%
% This work may be distributed and/or modified under the
% conditions of the LaTeX Project Public License, either version 1.3
% of this license or (at your option) any later version.
% The latest version of this license is in
% http://www.latex-project.org/lppl.txt
% and version 1.3 or later is part of all distributions of LaTeX
% version 2005/12/01 or later.
% 
% This work has the LPPL maintenance status `maintained'.
% 
% The Current Maintainer of this work is normas-utf-sf.net.
% 
% This work consists of the file normas-utf-tex.cls

% dependência: abntex >= 0.9-beta2



\RequirePackage{latexscholar-book}
\RequirePackage{latexscholar-text-spacing}
\RequirePackage{afterpage}

\geometry{left=3cm,right=2cm,top=3cm,bottom=2cm}

% Remove spacing between paragraphs.
\setlength{\parskip}{0pt}

\RequirePackage{pdfpages}
\RequirePackage{lastpage}

\def\titleen#1{\gdef\@titleen{#1}}%
\def\@titleen{\@latex@error{No \noexpand\titleen given}\@ehc}%

\def\advisor#1{\gdef\@advisor{#1}}%
\def\@advisor{\@latex@error{No \noexpand\advisor given}\@ehc}%

\def\coadvisor#1{\gdef\@coadvisor{#1}}%

\def\address#1{\gdef\@address{#1}}%
\def\@address{\@latex@error{No \noexpand\address given}\@ehc}%

\def\university#1{\gdef\@university{#1}}%
\def\@university{\@latex@error{No \noexpand\university given}\@ehc}%

\def\universityunit#1{\gdef\@universityunit{#1}}%
\def\@universityunit{\@latex@error{No \noexpand\universityunit given}\@ehc}%

\def\program#1{\gdef\@program{#1}}%
\def\@program{\@latex@error{No \noexpand\program given}\@ehc}%

\def\course#1{\gdef\@course{#1}}%
\def\@course{\@latex@error{No \noexpand\course given}\@ehc}%

\def\depositshortdate#1{\gdef\@depositshortdate{#1}}%
\def\@depositshortdate{\@latex@error{No \noexpand\depositshortdate given}\@ehc}%

\def\goal#1{\gdef\@goal{#1}}%
\def\@goal{\@latex@error{No \noexpand\goal given}\@ehc}%

\def\degree#1{\gdef\@degree{#1}}%
\def\@degree{\@latex@error{No \noexpand\degree given}\@ehc}%

\def\degreetype#1{\gdef\@degreetype{#1}}%
\def\@degreetype{\@latex@error{No \noexpand\degreetype given}\@ehc}%

\def\documenttype#1{\gdef\@documenttype{#1}}%
\def\@documenttype{\@latex@error{No \noexpand\documenttype given}\@ehc}%

\def\degreearea#1{\gdef\@degreearea{#1}}%
\def\@degreearea{\@latex@error{No \noexpand\degreearea given}\@ehc}%

\newcommand{\advisorlabel}{Orientador}
\newcommand{\coadvisorlabel}{Coorientador}

%Altera o tamanho da indentacao do paragrafo
\setlength{\parindent}{1.5cm} %

% \newcommand{\ABNTifnotempty}[2]{\ifthenelse{\not\equal{#1}{}}{#2}{}}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% CAPA

\newcommand{\coverpageone}{
	\thispagestyle{empty}
	\begin{adjustwidth}{-.5cm}{}
		\centering
		{
			\singlespacing
			\large\allcaps{\@university}\\
			\large\allcaps{\@universityunit}\\
			\large\allcaps{\@program}\par	
		}
		\vspace{56pt}	
		{
			\singlespacing
			\large\textbf{\allcaps{\@author}}\\
		}
		\vfill
		{
			\singlespacing
			\Large\textbf{\allcaps{\@title}} \par 
		}
		\vspace{48pt}
		\large\allcaps{\@documenttype}
		\vfill
		\textbf{\allcaps{\@address}}\par
		\textbf{\@depositshortdate}
	\end{adjustwidth}
	\clearpage{\pagestyle{empty}\cleardoublepage}
}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% FOLHA DE ROSTO 

\newcommand{\esporient}[2]
{
	\leftskip 0em
	\@tempdima 6.4em
	\advance\leftskip \@tempdima \null\nobreak\hskip -\leftskip
	{#1#2\hfil}
}

\newcommand{\@goalfulltext}{
	\@latex@error{No \noexpand\goalfulltext given}\@ehc
}

\newcommand{\coverpagetwo}
{
	\thispagestyle{empty}
	\begin{adjustwidth}{-.5cm}{}
		\begin{center}
				\singlespacing
				\large\textbf{\allcaps{\@author}}\\
		\end{center}
		\vfill
		\begin{center}
			\Large\textbf{\allcaps{\@title}}\par
		\end{center}
		\vspace{60pt}
%		\hspace{.4\textwidth}
		\hfill\begin{minipage}{.6\textwidth}
				\singlespacing
				\hyphenpenalty=10000
				\@goalfulltext\par
				\esporient{\numberline{\advisorlabel:}}{\hspace{.5mm}\@advisor}\par
				\@ifundefined{@coadvisor}{}{
					\vspace{-8pt}
					\esporient{\numberline{\coadvisorlabel:}}{\hspace{.5mm}\@coadvisor}\par
				}
		\end{minipage}
		\vfill
		\begin{center}
			\textbf{\allcaps{\@address}}\par
			\textbf{\@depositshortdate}
		\end{center}
	\end{adjustwidth}
}

% Title and cover page
%
\renewcommand{\maketitle}{%
	\begin{titlepage}
		\coverpageone
		\coverpagetwo
	\end{titlepage}
	\fichacat
	\afterpage{\null\newpage\cleardoublepage}
}

% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% % TERMO DE APROVACAO
% 
% \providecommand{\ABNTtextoaprovacaodata}{}
% \newcommand{\textoaprovacao}[1]{\renewcommand{\ABNTtextoaprovacaodata}{#1}}
% 
% \providecommand{\ABNTprimeiroassinadata}{}
% \newcommand{\primeiroassina}[1]{\renewcommand{\ABNTprimeiroassinadata}{#1}}
% 
% \providecommand{\ABNTsegundoassinadata}{}
% \newcommand{\segundoassina}[1]{\renewcommand{\ABNTsegundoassinadata}{#1}}
% 
% \providecommand{\ABNTterceiroassinadata}{}
% \newcommand{\terceiroassina}[1]{\renewcommand{\ABNTterceiroassinadata}{#1}}
% 
% \providecommand{\ABNTquartoassinadata}{}
% \newcommand{\quartoassina}[1]{\renewcommand{\ABNTquartoassinadata}{#1}}
% 
% \providecommand{\ABNTlocaldiadata}{}
% \newcommand{\localdia}[1]{\renewcommand{\ABNTlocaldiadata}{#1}}
% 
% \newcommand{\termodeaprovacao}
% {
% 	\begin{titlepage}
% 		\pretextualchapter{TERMO DE APROVA\c{C}\~AO}
% 		\vspace{-0.25cm}
% 		\begin{center}
% 			\large\ABNTautordata
% 		\end{center}
% 		\vspace{0.75cm}
% 		\begin{center}
% 			\large\allcaps{\ABNTtitulodata}
% 		\end{center}
% 		\vspace{0.75cm}
% 		{
% 			\singlespacing
% 			\noindent\ABNTtextoaprovacaodata\par
% 		}
% 		\setlength{\ABNTsignthickness}{0.4pt}
% 		\setlength{\ABNTsignskip}{1.75cm}
% 		\ABNTifnotempty{\ABNTprimeiroassinadata}%
% 		{
% 		\begin{center}
% 			\vspace{-0.5cm}
% 			\assinatura{\ABNTprimeiroassinadata}
% 		\end{center}
% 		}
% 		\ABNTifnotempty{\ABNTsegundoassinadata}%
% 		{
% 		\begin{center}
% 			\vspace{-0.5cm}
% 			\assinatura{\ABNTsegundoassinadata}
% 		\end{center}
% 		}
% 		\ABNTifnotempty{\ABNTterceiroassinadata}%
% 		{
% 		\begin{center}
% 			\vspace{-0.5cm}
% 			\assinatura{\ABNTterceiroassinadata}
% 		\end{center}
% 		}
% 		\ABNTifnotempty{\ABNTquartoassinadata}%
% 		{%
% 		\begin{center}
% 			\vspace{-0.5cm}
% 			\assinatura{\ABNTquartoassinadata}
% 		\end{center}
% 		}
% 		\vfill
% 		\begin{center}
% 			\ABNTlocaldiadata
% 		\end{center}
% 	\end{titlepage}
% }
% 
 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 %   Ficha catalografica
\providecommand{\UTFPRfichacatpumdata}{}
\newcommand{\fichacatpum}[1]{\renewcommand{\UTFPRfichacatpumdata}{#1}}
\providecommand{\UTFPRfichacatautordata}{}
\newcommand{\fichacatautor}[1]{\renewcommand{\UTFPRfichacatautordata}{#1}}
\providecommand{\UTFPRfichacatpgbibdata}{}
\newcommand{\fichacatpgbib}[1]{\renewcommand{\UTFPRfichacatpgbibdata}{#1}}
\providecommand{\UTFPRfichacatpalchadata}{}
\newcommand{\fichacatpalcha}[1]{\renewcommand{\UTFPRfichacatpalchadata}{#1}}
\providecommand{\UTFPRfichacatpdoisdata}{}
\newcommand{\fichacatpdois}[1]{\renewcommand{\UTFPRfichacatpdoisdata}{#1}}
\providecommand{\UTFPRfichacatbibdata}{}
\newcommand{\fichacatbib}[1]{\renewcommand{\UTFPRfichacatbibdata}{#1}}

\usepackage{refcount}
\newcommand{\pagedifference}[2]{%
	\number\numexpr\getpagerefnumber{#2}-\getpagerefnumber{#1}\relax}

\newcommand{\fichacat}{
	\newcommand{\lenauthor}{\hspace{8px}}
	\newcommand{\lencore}{\hspace{8px}}
	\thispagestyle{empty}{
		\footnotesize{
			\vspace*{12.8cm}
			\begin{center}
				\begin{tabular}{c}
					Dados Internacionais de Cataloga\c{c}\~{a}o na Publica\c{c}\~{a}o
				\end{tabular}
			\end{center}
		}
		\vspace{-25px}
		\begin{center}
			\line(1,0){385}
		\end{center}
		\vspace{-15px}
		\begin{table}[h!]
			\begin{center}
				\scriptsize
				\begin{tabular}{lp{12cm}}
					\UTFPRfichacatpumdata
					\lenauthor & \UTFPRfichacatautordata \\
					\lenauthor & \lencore \@title / \@author. \@address. UTFPR,  \@depositshortdate. \\
					           & \lencore \pageref{LastPage}. f. : il. ; 30 cm \\
					           & \\
					           & \lencore Orientador: \@advisor. \\
\@ifundefined{@coadvisor}{}{
							   & \lencore \coadvisorlabel: \@coadvisor \\
}
							   & \lencore Monografia (Graduação) - \@university. \@program. \@address, \@depositshortdate.\\
							   & \lencore Bibliografia: f. \pageref{bibstart} - \pageref{bibend}. \\
					           & \\
					           & \lencore \UTFPRfichacatpalchadata \\
					           & \\
					           & \hfill \UTFPRfichacatpdoisdata \\
			  \end{tabular}
      \end{center}
    \end{table}
    \vspace{-50px}

    \begin{center}
      \line(1,0){385}
    \end{center}

    \vspace{-25px}
    \center \footnotesize \UTFPRfichacatbibdata
    \newpage
	}
}
 
% Environment to write abstract (in English and native language). This
% environment has narrower margins.
\newenvironment{abstract}{
	\chapter*{Abstract}
	\setlength{\parindent}{0pt}
		
	\vspace{1cm}
	\UTFPRfichacatautordata. \@titleen. \@depositshortdate.
	\pageref{LastPage}. f. Monografia (\@program), \@university.
	\@address, \@depositshortdate.
	
	\vspace{1cm}
}{
	\vspace{1cm}
}

\newenvironment{resumo}{
	\chapter*{Resumo}
	\setlength{\parindent}{0pt}

	\vspace{1cm}
	\UTFPRfichacatautordata. \@title. \@depositshortdate.
	 \pageref{LastPage}. f. Monografia (\@program), \@university.
	 \@address, \@depositshortdate.

	\vspace{1cm}
}{
	\vspace{1cm}
}

\newcommand{\palavraschaves}[1]{\noindent\textbf{Palavras-chaves:} #1}

\newcommand{\keywords}[1]{\noindent\textbf{Keywords:} #1}


% Avoids widow lines (do not set a value higher than 10000 as this may disable
% the intended behaviour, do not ask me why!).
\widowpenalty = 9999
\clubpenalty = 9999

% Do no use uppercase for \bibname.
\renewenvironment{thebibliography}[1]{
	\addcontentsline{toc}{chapter}{\numberline{}\bibname}
	\chapter*{\bibname}%
	\label{bibstart}
	
	\list{
		\@biblabel{\@arabic\c@enumiv}
	}{
		\settowidth\labelwidth{\@biblabel{#1}}%
		\leftmargin\labelwidth
		\advance\leftmargin\labelsep
		\@openbib@code
		\usecounter{enumiv}%
		\let\p@enumiv\@empty
		\renewcommand\theenumiv{\@arabic\c@enumiv}
	}
	\sloppy
	\clubpenalty4000
	\@clubpenalty \clubpenalty
	\widowpenalty4000%
	\sfcode`\.\@m
}{
	\def\@noitemerr{\@latex@warning{Empty thebibliography environment}}
	\endlist
	\label{bibend}
}

% Command to create a dedicate page.
\newcommand{\dedicate}{
	\cleardoublepage
	\vfill
	\hfill
	\parbox{.4\linewidth}{\textsl{\@dedication}}
	\vspace{3cm}
}

\newenvironment{agradecimentos}{
	\cleardoublepage
	\chapter*{Agradecimentos}
}{
}

% Pretty chapter start at frontmatter
\newpagestyle{frontmatter}{
	\sethead{}{}{}
	\setfoot{}{}{}
}

% Pretty chapter start at mainmatter
\newpagestyle{mainmatter}[\small\sffamily]{
	\sethead{}{}{\thepage}
	\setfoot{}{}{}
}

% Pretty chapter start at backmatter
\newpagestyle{backmatter}{
	\sethead{}{}{\thepage}
	\setfoot{}{}{}
}


\renewcommand\frontmatter{%
	\cleardoublepage
	\@mainmatterfalse
	\pagestyle{empty}
	\pagenumbering{gobble}
	\titlespacing{\chapter}{0pt}{0em}{2em}[0pt]
}

\renewcommand\mainmatter{
	\cleardoublepage
	\@mainmattertrue
	\pagestyle{mainmatter}
	\pagenumbering{arabic}
	\titlespacing{\chapter}{0pt}{0em}{2em}[0pt]
}


\def\pagenumbering#1{%
	\gdef\thepage{\csname @#1\endcsname \c@page}}

\renewcommand\backmatter{%
	\cleardoublepage
	\@mainmatterfalse
	\pagestyle{backmatter}
	\pagenumbering{arabic}
	\titlespacing{\chapter}{0pt}{0em}{2em}[0pt]
}

\newlength{\chaptertitleheight}
\titleformat{\chapter}[display]
{\normalfont\Large\sffamily} % Text format
{ % Label
	\rule[32pt]{.7\linewidth}{4pt}
	\hspace{-10pt}
	\shadowbox{
		\begin{minipage}{.18\linewidth}
			\centering
			\textsc{\Large\chaptertitlename}\\
			\vspace{1ex}
			{\fontsize{80}{100}\selectfont\thechapter}\\
			\vspace{1ex}
		\end{minipage}
	}
	\hspace{-14pt}
	\leaders\hbox{\rule[32pt]{.1pt}{4pt}}\hfill
}
{0pt}
{\Huge\raggedright}
[\rule{\linewidth}{4pt}]

\newsavebox{\scholar@chaptertitle}%
\let\scholar@oldchapter\chapter%
\renewcommand*\chapter{%
	\@ifstar{\scholar@oldchapter@starred}{\@dblarg\scholar@oldchapter@notstarred}}

\newcommand*\scholar@oldchapter@starred[1]{
	\savebox{\scholar@chaptertitle}{\Huge\parbox[t]{\textwidth}{#1}}%
	\settototalheight{\chaptertitleheight}{\usebox{\scholar@chaptertitle}}%
	\addtolength{\chaptertitleheight}{3cm}%
	\titlespacing{\chapter}{0pt}{0em}{\chaptertitleheight}[0pt]
	\scholar@oldchapter*{#1}}

\def\scholar@oldchapter@notstarred[#1]#2{
	\savebox{\scholar@chaptertitle}{\Huge\parbox[t]{\textwidth}{#2}}%
	\settototalheight{\chaptertitleheight}{\usebox{\scholar@chaptertitle}}%
	\addtolength{\chaptertitleheight}{7cm}%
	\titlespacing{\chapter}{0pt}{0em}{\chaptertitleheight}[0pt]%
	\scholar@oldchapter[{#1}]{#2}}%
